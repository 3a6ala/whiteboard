///////////////////////////////////////////////////////////////////////////
////////////////////////// Drawing Manager ////////////////////////////////
///////////////////////////////////////////////////////////////////////////
function canvas(e,t){this.ctx;this.canvasElm;this.canvasWidth;this.canvasHeight;this.canvasOffsetTop;this.canvasOffsetLeft;this.mouseX=0;this.mouseY=0;this.mouseDown=!1;this.scrollBarSize=25;this.currentlyDraggingObject;this.renderObjects=new Array;this.ctx=document.getElementById(e).getContext("2d");this.canvasElm=document.getElementById(e);this.contentSize=new point(0,0);this.absoluteContentSize=new point(0,0);this.contentSizePadding=new point(400,400);this.size=elementSpace(this.canvasElm);this.size.x-=this.scrollBarSize;this.size.y-=this.scrollBarSize;this.canvasElm.style.width=this.size.x+"px";this.canvasElm.style.height=this.size.y+"px";this.canvasElm.width=this.canvasElm.offsetWidth;this.canvasElm.height=this.canvasElm.offsetWidth;this.canvasWidth=this.canvasElm.offsetWidth;this.canvasHeight=this.canvasElm.offsetHeight;this.canvasOffsetTop=elementPosition(this.canvasElm).y;this.canvasOffsetLeft=elementPosition(this.canvasElm).x;canvases.push(this);var n=null,r=this;this.sizeToContent=function(){r.absoluteContentSize.x=0;r.absoluteContentSize.y=0;for(var e=0;e<r.renderObjects.length;e++)if(r.renderObjects[e].lowerRight){r.renderObjects[e].lowerRight.x>r.absoluteContentSize.x&&(r.absoluteContentSize.x=r.renderObjects[e].lowerRight.x);r.renderObjects[e].lowerRight.y>r.absoluteContentSize.y&&(r.absoluteContentSize.y=r.renderObjects[e].lowerRight.y)}r.absoluteContentSize.x+=r.contentSizePadding.x;r.absoluteContentSize.y+=r.contentSizePadding.y;var t=new point(r.absoluteContentSize.x-r.contentSize.x,r.absoluteContentSize.y-r.contentSize.y);if(Math.abs(t.x)+Math.abs(t.y)>5&&n==null)n=window.setInterval(r.stretchContentTimed,30);else if(n==null){r.contentSize.x=r.absoluteContentSize.x;r.contentSize.y=r.absoluteContentSize.y}};this.stretchToContent=function(e,t){r.contentSize.x<e+r.contentSizePadding.x&&(r.contentSize.x=e+r.contentSizePadding.x);r.contentSize.y<t+r.contentSizePadding.y&&(r.contentSize.y=t+r.contentSizePadding.y);r.absoluteContentSize.x=r.contentSize.x;r.absoluteContentSize.y=r.contentSize.y};this.stretchContentTimed=function(){var e=new point(r.absoluteContentSize.x-r.contentSize.x,r.absoluteContentSize.y-r.contentSize.y);r.contentSize.x+=e.x/8;r.contentSize.y+=e.y/8;if(Math.abs(e.x)+Math.abs(e.y)<15){r.contentSize.x=r.absoluteContentSize.x;r.contentSize.y=r.absoluteContentSize.y;window.clearInterval(n);n=null}r.draw()};this.resetCanvas=function(){r.size=elementSpace(this.canvasElm);r.size.x-=r.scrollBarSize;r.size.y-=r.scrollBarSize;r.contentSize.x>r.size.x&&(r.size.x=r.contentSize.x);r.contentSize.y>r.size.y&&(r.size.y=r.contentSize.y);r.canvasElm.width=r.size.x;r.canvasElm.height=r.size.y;r.canvasWidth=r.size.x;r.canvasHeight=r.size.y;r.canvasElm.style.width=r.size.x+"px";r.canvasElm.style.height=r.size.y+"px";r.canvasOffsetTop=elementPosition(r.canvasElm).y;r.canvasOffsetLeft=elementPosition(r.canvasElm).x};this.draw=function(){r.resetCanvas();for(var e=0;e<r.renderObjects.length;e++)r.renderObjects[e].draw&&r.renderObjects[e].draw(r.ctx)};this.updateCanvas=function(){t();r.draw()};this.containsMouse=function(){return r.mouseX>0&&r.mouseY>0&&r.mouseX<r.canvasWidth&&r.mouseY<r.canvasHeight};window.addEventListener("resize",this.draw,!1)};